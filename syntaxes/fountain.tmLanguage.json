{
  "fileTypes": [
    "fountain"
  ],
  "name": "Fountain",
  "scopeName": "text.source.fountain",
  "uuid": "BA0B1FEB-1E9C-4283-8F3B-E80E7879EA91",
  "patterns": [
    {
      "include": "#dialogue"
    },
    {
      "include": "#block_except_dialogue"
    }
  ],
  "repository": {
    "dialogue_fake": {
      "name": "meta.paragraph.text",
      "begin": "^[ \\t]*(?![#!]|(\\[\\[)|(SUPERIMPOSE:))(((?!@)[^\\p{Ll}\\r\\n]*?\\p{Lu}[^\\p{Ll}\\r\\n]*?)|((@)[^\\r\\n]*?))(\\(.*\\))?(\\s*\\^)?\\s*$",
      "end": "^\\s*$"
    },
    "dialogue": {
      "contentName": "string",
      "begin": "^[ \\t]*(?![#!]|(\\[\\[)|(SUPERIMPOSE:)|(?:/\\*))(((?!@)[^\\p{Ll}\\r\\n]*?\\p{Lu}[^\\p{Ll}\\r\\n]*?)|((@)[^\\r\\n]*?))(\\(.*\\))?(\\s*\\^)?\\s*(?<!\\s*TO:\\s*)$",
      "end": "^\\s*$",
      "beginCaptures": {
        "3": {
          "name": "variable.parameter.url.css"
        },
        "6": {
          "name": "comment.block.fountain"
        },
        "7": {
          "name": "comment.block.fountain"
        },
        "8": {
          "name": "comment.block.fountain"
        }
      },
      "patterns": [
        {
          "include": "#comments"
        },
        {
          "name": "entity.name.tag",
          "begin": "^[ \\t]*\\(",
          "end": "(\\)\\s*$|(?=^\\s*$))",
          "patterns": [
            {
              "include": "#notes"
            }
          ]
        },
        {
          "include": "#markup"
        },
        {
          "include": "#lyrics"
        }
      ]
    },
    "block_except_dialogue": {
      "begin": "^(?=\\s*[^\\s]+.*$)",
      "end": "^\\s*$",
      "patterns": [
        {
          "include": "#comments"
        },
        {
          "include": "#title_page"
        },
        {
          "include": "#scene_headings"
        },
        {
          "include": "#sections"
        },
        {
          "include": "#synopses"
        },
        {
          "include": "#transitions"
        },
        {
          "include": "#center"
        },
        {
          "include": "#markup"
        },
        {
          "include": "#notes"
        },
        {
          "include": "#pagebreaks"
        },
        {
          "include": "#lyrics"
        }
      ]
    },
    "comments": {
      "name": "comment.block.fountain",
      "begin": "/\\*",
      "end": "\\*/",
      "patterns": [
        {
          "include": "#comments"
        }
      ]
    },
    "title_page": {
      "begin": "^(?i)(title|credit|authors?|source|draft date|date|watermark|header|footer|contact|contact info|copyright|notes|font|font italic|font bold|font bold italic|revision|tl|tc|tr|cc|br|bl)(:)",
      "end": "^((?=(?i)(title|credit|authors?|source|draft date|date|watermark|header|footer|contact|contact info|copyright|notes|font|font italic|font bold|font bold italic|revision|tl|tc|tr|cc|br|bl))|(?=\\s*$))",
      "name": "meta.paragraph.text",
      "beginCaptures": {
        "1": {
          "name": "keyword.control"
        },
        "2": {
          "name": "keyword.operator"
        }
      },
      "patterns": [
        {
          "include": "#markup"
        },
        {
          "include": "#link-inline"
        }
      ]
    },
    "scene_headings": {
      "match": "(?i)^[ \\t]*([.]|(?:[*]{0,3}_?)(?:int|ext|est|int[.]?\\/ext|i[.]?\\/e)[.])(.+?)(?:(#)([^\\n#]+)(#))?\\s*$",
      "captures": {
        "1": {
          "name": "keyword.other.class"
        },
        "2": {
          "name": "token.error-token"
        },
        "3": {
          "name": "comment.block.fountain"
        },
        "4": {
          "name": "constant.numeric.scene.fountain"
        },
        "5": {
          "name": "comment.block.fountain"
        }
      }
    },
    "sections": {
      "begin": "(#{1,6})\\s*",
      "beginCaptures": {
        "1": {
          "name": "comment.block.fountain"
        }
      },
      "contentName": "variable.other.constant",
      "end": "\\s*(#*)$\\n?",
      "name": "comment.block.fountain"
    },
    "synopses": {
      "name": "comment.block.fountain.synopses",
      "match": "^={1}([^<>=][^<>]+?)$"
    },
    "transitions": {
      "name": "variable.other.constant",
      "match": "^\\s*(?:(>)[^<\\n\\r]*|[A-Z ]+TO:)$",
      "captures": {
        "1": {
          "name": "comment.block.fountain"
        }
      }
    },
    "center": {
      "name": "token.warn-token",
      "match": "^\\s*(>)[^<>\\n]+(<)\\s*$",
      "captures": {
        "1": {
          "name": "comment.block.fountain"
        },
        "2": {
          "name": "comment.block.fountain"
        }
      }
    },
    "notes": {
      "name": "comment.block",
      "match": "(?:\\[{2}(?!\\[+))([\\s\\S]+?)(?:\\]{2}(?!\\]+))"
    },
    "pagebreaks": {
      "name": "variable.other.constant",
      "match": "===(=+)?"
    },
    "lyrics": {
      "name": "markup.italic string",
      "begin": "^\\s*~.*",
      "end": "$"
    },
    "markup": {
      "patterns": [
        {
          "name": "markup.code",
          "begin": "^\\s*>(?=.*<)",
          "end": "<$",
          "patterns": [
            {
              "include": "#markup"
            }
          ]
        },
        {
          "name": "markup.bold.fountain",
          "begin": "^\\s*>(?=.*<)",
          "end": "<$",
          "patterns": [
            {
              "include": "#markup"
            }
          ]
        },
        {
          "name": "markup.underline.fountain",
          "begin": "_(?=.*_)",
          "end": "_",
          "patterns": [
            {
              "include": "#markup"
            }
          ]
        },
        {
          "name": "markup.heading",
          "match": "^(#+)(.*)$",
          "patterns": [
            {
              "include": "#markup"
            }
          ]
        },
        {
          "name": "markup.bold.fountain",
          "begin": "(?x)\r\n                  (\\*\\*|__)(?=\\S)                        # Open\r\n                  (?=\r\n                     (\r\n                         <[^>]*+>                     # HTML tags\r\n                       | (?<raw>`+)([^`]|(?!(?<!`)\\k<raw>(?!`))`)*+\\k<raw>\r\n                                                   # Raw\r\n                       | \\\\[\\\\`*_{}\\[\\]()#.!+\\->]?+         # Escapes\r\n                       | \\[\r\n                        (\r\n                                (?<square>               # Named group\r\n                                 [^\\[\\]\\\\]            # Match most chars\r\n                                  | \\\\.                  # Escaped chars\r\n                                  | \\[ \\g<square>*+ \\]      # Nested brackets\r\n                                )*+\r\n                           \\]\r\n                           (\r\n                              (                    # Reference Link\r\n                                 [ ]?              # Optional space\r\n                                 \\[[^\\]]*+\\]          # Ref name\r\n                              )\r\n                             | (                   # Inline Link\r\n                                 \\(                # Opening paren\r\n                                    [ \\t]*+           # Optional whtiespace\r\n                                    <?(.*?)>?         # URL\r\n                                    [ \\t]*+           # Optional whtiespace\r\n                                    (              # Optional Title\r\n                                       (?<title>['\"])\r\n                                       (.*?)\r\n                                       \\k<title>\r\n                                    )?\r\n                                 \\)\r\n                              )\r\n                           )\r\n                        )\r\n                       | (?!(?<=\\S)\\1).                  # Everything besides\r\n                                                   # style closer\r\n                     )++\r\n                     (?<=\\S)\\1                        # Close\r\n                  )",
          "captures": {
            "1": {
              "name": "punctuation.definition.markup.bold.fountain"
            }
          },
          "end": "(?<=\\S)(\\1)",
          "patterns": [
            {
              "applyEndPatternLast": 1,
              "begin": "(?=<[^>]*?>)",
              "end": "(?<=>)",
              "patterns": [
                {
                  "include": "text.html.basic"
                }
              ]
            }
          ]
        },
        {
          "name": "markup.italic.fountain",
          "begin": "(?x)\r\n                  (\\*|_)(?=\\S)                        # Open\r\n                  (?=\r\n                     (\r\n                         <[^>]*+>                     # HTML tags\r\n                       | (?<raw>`+)([^`]|(?!(?<!`)\\k<raw>(?!`))`)*+\\k<raw>\r\n                                                   # Raw\r\n                       | \\\\[\\\\`*_{}\\[\\]()#.!+\\->]?+         # Escapes\r\n                       | \\[\r\n                        (\r\n                                (?<square>               # Named group\r\n                                 [^\\[\\]\\\\]            # Match most chars\r\n                                  | \\\\.                  # Escaped chars\r\n                                  | \\[ \\g<square>*+ \\]      # Nested brackets\r\n                                )*+\r\n                           \\]\r\n                           (\r\n                              (                    # Reference Link\r\n                                 [ ]?              # Optional space\r\n                                 \\[[^\\]]*+\\]          # Ref name\r\n                              )\r\n                             | (                   # Inline Link\r\n                                 \\(                # Opening paren\r\n                                    [ \\t]*+           # Optional whtiespace\r\n                                    <?(.*?)>?         # URL\r\n                                    [ \\t]*+           # Optional whtiespace\r\n                                    (              # Optional Title\r\n                                       (?<title>['\"])\r\n                                       (.*?)\r\n                                       \\k<title>\r\n                                    )?\r\n                                 \\)\r\n                              )\r\n                           )\r\n                        )\r\n                       | \\1\\1                      # Must be bold closer\r\n                       | (?!(?<=\\S)\\1).                  # Everything besides\r\n                                                   # style closer\r\n                     )++\r\n                     (?<=\\S)\\1                        # Close\r\n                  )\r\n               ",
          "captures": {
            "1": {
              "name": "punctuation.definition.markup.italic.fountain"
            }
          },
          "end": "(?<=\\S)(\\1)((?!\\1)|(?=\\1\\1))",
          "patterns": [
            {
              "include": "#markup"
            }
          ]
        },
        {
          "patterns": [
            {
              "include": "#notes"
            },
            {
              "include": "#comments"
            }
          ]
        }
      ]
    },
    "link-inline": {
      "captures": {
        "1": {
          "name": "punctuation.definition.tag"
        },
        "3": {
          "name": "punctuation.definition.tag"
        },
        "5": {
          "name": "punctuation.definition.tag"
        },
        "6": {
          "name": "punctuation.definition.tag"
        },
        "10": {
          "name": "punctuation.definition.tag"
        },
        "4": {
          "name": "markup.underline.link.fountain",
          "patterns": [
            {
              "include": "#markup"
            },
            {
              "include": "#link-inline"
            }
          ]
        },
        "7": {
          "name": "keyword"
        }
      },
      "match": "(!)?(\\[?(\\[)([^\\]\\[]*\\[?[^\\]\\[]*\\]?[^\\]\\[]*)(\\])(\\()(.+?)(?:\\s+([\"'])(.*?)\\4)?(\\)))",
      "name": "meta.link.inline.fountain"
    },
    "test2": {
      "name": "variable.other.constant",
      "begin": "^(?!\\s*$).*$",
      "while": "^(?!\\s*$).*$"
    }
  }
}